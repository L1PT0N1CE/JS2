// ==UserScript==
// @name         APM FWO Alt+C Autofill Comment TESTPHASE
// @namespace    https://phonetool.amazon.com/users/kanataza
// @version      1.4
// @description  Inserts the template into the rich-text comment field via Alt+C
// @author       kanataza
// @icon         https://media.licdn.com/dms/image/v2/D4E03AQEkSQG-ayth3g/profile-displayphoto-shrink_200_200/profile-displayphoto-shrink_200_200/0/1730057709648?e=2147483647&v=beta&t=C7VGPq9vEfeuAcJa6aO7eBLN8GDKcR5c70l1ABnA3DU
// @match        aHR0cHM6Ly9ldTEuZWFtLmh4Z25zbWFydGNsb3VkLmNvbS8=
// @grant        none
// ==/UserScript==

(function () {
    'use strict';

    const TEMPLATE = `[Situation/Problem Description]:\t



[RootCause]:\t\t\t\t\t



[Task/Action (including parts)]:\t



Teile (Azads Sparepartliste) rauskopieren und einfügen:


Anzahl der Mitarbeiter: xx Personen
Dauer: xx Stunden.

[Result]: Bitte nach Erledigung ausfüllen\t\t\t\t\t

[Follow-up action (if applicable)]: `;

    function getEditorBody() {
        // find the HTMLEditor iframe
        const iframe = document.querySelector('iframe.x-htmleditor-iframe');
        if (!iframe) return null;

        const doc = iframe.contentDocument || iframe.contentWindow?.document;
        return doc?.body || null;
    }

    function insertTemplate() {
        const body = getEditorBody();
        if (!body) {
            console.warn('Rich-text editor not found or not ready');
            return;
        }

        body.innerHTML = TEMPLATE.replace(/\n/g, '<br>');

        // notify the underlying ExtJS form that something changed
        ['input', 'change', 'keyup'].forEach(evt =>
            body.dispatchEvent(new Event(evt, { bubbles: true }))
        );

        console.log('✅ Template inserted with Alt+C');
    }

    // listen globally for Alt + C
    document.addEventListener('keydown', (e) => {
        if (e.altKey && e.key.toLowerCase() === 'c') {
            e.preventDefault();
            insertTemplate();
        }
    });
})();